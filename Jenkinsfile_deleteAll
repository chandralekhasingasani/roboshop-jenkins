pipeline{
    agent {
        label 'agent'}

    parameters {
        choice(name: 'ENV', choices: ['dev','prod'], description: 'Pick something')
    }
    stage('DESTROY') {

        parallel {

            stage('CART') {
                steps {
                    dir('CART') {
                        git branch: 'main', url: 'https://github.com/chandralekhasingasani/cart-infra.git'
                        sh 'terraform init -backend-config=env-${ENV}/backend.tfvars'
                        sh 'terraform destroy -auto-approve -var-file=env-${ENV}/${ENV}.tfvars '
                    }
                }
            }

            stage('SHIPPING') {
                steps {
                    dir('SHIPPING') {
                        git branch: 'main', url: 'https://github.com/chandralekhasingasani/shipping-infra.git'
                        sh 'terraform init -backend-config=env-${ENV}/backend.tfvars'
                        sh 'terraform destroy -auto-approve -var-file=env-${ENV}/${ENV}.tfvars -var APP_VERSION=2.0.0'
                    }
                }
            }

        }
    }

    stage('DEAFULT-TGW') {
        steps {
            dir('DEAFULT-TGW') {
                git branch: 'main', url: 'https://github.com/chandralekhasingasani/terraform-vpc-transit-setup.git'
                sh 'terraform init -backend-config=env-${ENV}/backend.tfvars'
                sh 'terraform destroy -auto-approve -var-file=env-${ENV}/${ENV}.tfvars'
            }
        }

    }

    post {
        always {
            cleanWs()
        }
    }


}

